<nz-flex nzAlign="center" nzJustify="space-between">
  <h1>Liste des Rendez-vous</h1>
  <div style="display: flex; align-items: center; gap: 10px">
    <app-search-bar></app-search-bar>
    <app-reload-button (_onRefresh)="onRefresh()"></app-reload-button>
    <!-- @if (can(SCOPES.CREATE, RESOURCES.APPOINTMENT)) {
      <button nz-button [nzType]="'primary'" (click)="onAdd()">
        <span>Ajouter</span>
      </button>
    } -->
  </div>
</nz-flex>
<br />
<!-- <nz-modal
  [(nzVisible)]="open"
  nzTitle="{{ currentRecord ? 'Modifier' : 'Ajouter' }} un RV"
  (nzOnCancel)="handleCancel()"
  [nzFooter]="null"
  nzWidth="70%"
  [nzStyle]="{ top: '30px' }"
  [nzBodyStyle]="{ overflow: 'auto', maxHeight: 'calc(100vh - 120px)' }"
>
  <ng-container *nzModalContent>
    <app-add-appointment
      [currentRecord]="currentRecord"
      (_onClose)="handleCancel()"
      (_onRefresh)="onRefresh()"
    ></app-add-appointment>
  </ng-container>
</nz-modal> -->

<nz-modal
  [(nzVisible)]="open"
  nzTitle="{{ currentRecord ? 'Modifier' : 'Créer' }} un rendez-vous"
  (nzOnCancel)="handleCancel()"
  [nzFooter]="null"
  nzWidth="50%"
  [nzStyle]="{ top: '30px' }"
  [nzBodyStyle]="{ overflow: 'auto', maxHeight: 'calc(100vh - 120px)' }"
>
  <ng-container *nzModalContent>
    <app-add-appointment 
      [currentRecord]="currentRecord"
      (_onClose)="handleCancel()"
      (_onRefresh)="onRefresh()"
      [patientId]="patientId"
    ></app-add-appointment>
  </ng-container>
</nz-modal>

<nz-table
  #basicTable
  nzSize="small"
  [nzData]="listAppointments"
  [nzLoading]="loading"
  [nzTotal]="totalElements"
  [nzPageSize]="pageSize"
  [nzPageIndex]="pageNumber"
  [nzShowSizeChanger]="true"
  [nzShowPagination]="true"
  (nzPageIndexChange)="onPageChange($event)"
  (nzPageSizeChange)="onPageSizeChange($event)"
  [nzFrontPagination]="false"
  [nzShowTotal]="rangeTemplate"
>
  <thead>
    <tr>
      
      <th>N°</th>
      <th>Date</th>
      <th>Patient</th>
      <th>Medecin</th>
      <th>Statut</th>

      <th></th>
    </tr>
  </thead>
  <tbody>
    @for (data of basicTable.data; track data.id) {
    <tr>
      <td>{{ data.appointmentNum }}</td>
      <td>
       {{ data.appointmentDate | date:'dd/MM/yy à HH:mm' }}
      </td>
      <td>{{ data.patientName }}</td>
      <td>{{ data.doctorName }}</td>
      <td> 
          <nz-tag [nzColor]="displayTagForAppointmentStatus(data.status).color" [nzBordered]="false">{{ displayTagForAppointmentStatus(data.status).text }}</nz-tag>

      </td>
     

      <td>
        @if (can(SCOPES.UPDATE, RESOURCES.APPOINTMENT)) {
        <button
          nz-button
          [nzType]="'text'"
          style="color: var(--primary-color)"
          (click)="onUpdate(data)"
        >
          <nz-icon nzType="edit" />
        </button>
        } &nbsp; @if (can(SCOPES.DELETE, RESOURCES.APPOINTMENT)) {
        <button
          nz-button
          [nzType]="'text'"
          style="color: red"
          (click)="onDelete(data.id)"
        >
          <nz-icon nzType="delete" />
        </button>
        }
      </td>
    </tr>
    }
  </tbody>
</nz-table>

<ng-template #totalTemplate let-total>Total {{ total }} éléments</ng-template>
<ng-template #rangeTemplate let-range="range" let-total>
  {{ range[0] }}-{{ range[1] }} sur {{ total }} éléments
</ng-template>
